# ===========================================
# Developer Bash Config â€” Martin Stadler
# For Kubernetes, Containers, and DevOps
# ===========================================

# Load only once per interactive shell
[[ $- != *i* ]] && return 0
if [[ "${BASHRC_DEVELOPER_LOADED:-}" == "1" ]]; then
  return 0
fi
BASHRC_DEVELOPER_LOADED=1

# ==================================================
# Environment Variables
# ==================================================
export EDITOR=vi
export VISUAL=vi
export PAGER=less
export LESS="-R"

# ==================================================
# GitHub CLI shortcuts
# ==================================================
alias ghc='gh repo clone'
alias ghr='gh repo view --web'
alias ghp='gh pr view --web'

# ==================================================
# Docker Compose Shortcuts (additional to .bash_aliases)
# ==================================================
alias dcupdate='docker compose pull && docker compose up -d --remove-orphans'
alias dctail='docker compose logs -f --tail=100'

# ==================================================
# Package Management (additional to .bash_aliases)
# ==================================================
alias dpi='sudo dpkg -i'
alias opi='opkg install'
alias ops='opkg list-installed | grep'

# ==================================================
# Kubernetes Extras
# ==================================================
# Use kubecolor if available
if command -v kubecolor >/dev/null 2>&1; then
  alias kubectl='kubecolor'
fi

# --- k0rdent-specific ---
alias kdlogin='k0rdent auth login'
alias kdlist='k0rdent cluster list'
alias kdinfo='k0rdent cluster info'
alias kdapply='k0rdent apply -f'

# ==================================================
# Useful Functions
# ==================================================

# Quick GitHub clone + enter directory
gh_clone() {
  if [ -z "$1" ]; then
    echo "Usage: gh_clone <owner/repo>"
    return 1
  fi
  gh repo clone "$1"
  cd "$(basename "$1")" || return
}

# Quick repo creation
gh_create_repo() {
  if [ -z "$1" ]; then
    echo "Usage: gh_create_repo <repo-name>"
    return 1
  fi
  gh repo create "$1" --private --source=. --push
}

# Docker cleanup with confirmation
dcleanall() {
  echo "ðŸ§¹ Cleaning all Docker resources..."
  docker stop $(docker ps -aq) 2>/dev/null || true
  docker system prune -af --volumes
}

# Kubernetes context summary
kctxs() {
  echo "Current context:"
  kubectl config current-context
  echo
  echo "Available contexts:"
  kubectl config get-contexts
}

# Kubernetes namespace quick switch and display
kn() {
  if [ -z "$1" ]; then
    kubectl config view --minify --output 'jsonpath={..namespace}'
    echo
  else
    kubectl config set-context --current --namespace="$1"
  fi
}

# Quick pod logs for a deployment
klog() {
  if [ -z "$1" ]; then
    echo "Usage: klog <pod-name-prefix> [namespace]"
    return 1
  fi
  local ns="${2:---all-namespaces}"
  kubectl logs -f $(kubectl get pods $ns | grep "$1" | head -1 | awk '{print $1}') $ns
}

git_acp() {
    local msg=""
    local date=$(date +"%Y-%m-%d")
    local push=true

    # Parse arguments
    for arg in "$@"; do
        case "$arg" in
            --no-push)
                push=false
                ;;
            *)
                msg+="$arg "
                ;;
        esac
    done
    msg=$(echo "$msg" | sed 's/[[:space:]]*$//')  # trim trailing space

    # Default commit message if none provided
    if [ -z "$msg" ]; then
        msg="Update $date"
    fi

    git add .
    git commit -m "$msg"

    if [ "$push" = true ]; then
        echo
        echo "ðŸ“‚ Repository status before push:"
        git --no-pager status -sb
        echo
        read -p "Push to remote? [y/N] " confirm
        if [[ "$confirm" =~ ^[Yy]$ ]]; then
            git push
        else
            echo "Push skipped."
        fi
    else
        echo "Push disabled by flag (--no-push)."
    fi
}

# --- Message ---
echo "ðŸ§© Developer shell loaded"
